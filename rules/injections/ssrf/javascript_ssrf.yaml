rules:
  - id: javascript_ssrf
    languages:
      - typescript
      - javascript
    severity: CRITICAL
    message: |
      Semgrep found a match for possible SSRF vulnerability.
    pattern-either:

      - pattern-either:
          # axios
          - patterns:
            - pattern: axios.$AXIOSMETHOD(..., $TARGET, ...);
            - pattern-inside: |
                app.$HTTPMETHOD("...", async ($REQ, $RES) => {
                  ...
                  const $TARGET = $REQ.body.url;
                });

          # simple fetch
          - patterns:
            - pattern: fetch(..., $TARGET, ...)
            - pattern-inside: |
                app.$HTTPMETHOD("...", async ($REQ, $RES) => {
                    ...
                    const $TARGET = $REQ.query.url;
                    ...
                  });