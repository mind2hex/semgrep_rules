rules:
  - id: java-tainted-091-Log-Injection
    languages:
      - java
    severity: LOW
    message: >
      The system logs entries that contain input from untrusted sources without
      properly validating, sanitizing or escaping their content.
    mode: taint
    pattern-sources:
      # javax.servlet.http.HttpServletRequest
      - pattern-either:
        - pattern: $REQUEST.getParameter(...)
        - pattern: $REQUEST.getParameterValues(...)
        - pattern: $REQUEST.getParameterMap()
        - pattern: $REQUEST.getQueryString()
        - pattern: $REQUEST.getHeader(...)
        - pattern: $REQUEST.getHeaders(...)
        - pattern: $REQUEST.getCookies()

      # javax.servlet.ServletRequest
      - pattern-either:
        - pattern: $REQUEST.getParameter(...)
        - pattern: $REQUEST.getParameterValues(...)
        - pattern: $REQUEST.getParameterMap()
        - pattern: $REQUEST.getQueryString()
        - pattern: $REQUEST.getInputStream()
        - pattern: $REQUEST.getReader()

      # org.springframework.web.servlet.mvc.Controller
      - pattern-either:
        - pattern: $REQUEST.getParameter(...)
        - pattern: $REQUEST.getParameterValues(...)
        - pattern: $REQUEST.getParameterMap()

      # org.springframework.web.bind.annotation.RequestParam
      - patterns:
        - pattern: |
            Mono<RestResponse> $METHOD_NAME(..., @RequestParam(...) $PARAM, ...) 
        - focus-metavariable: $PARAM

      # org.springframework.web.bind.annotation.PathVariable
      - patterns:
        - pattern: |
            Mono<RestResponse> $METHOD_NAME(..., @PathVariable(...) $PARAM, ...)
        - focus-metavariable: $PARAM

      # org.springframework.web.bind.annotation.RequestBody
      - patterns:
        - pattern: |
             Mono<RestResponse> $METHOD_NAME(..., @RequestBody $PARAM, ...)
        - focus-metavariable: $PARAM

      # org.springframework.web.bind.annotation.ModelAttribute
      - patterns:
        - pattern: |
            Mono<RestResponse> $METHOD_NAME(..., @ModelAttribute(...) $PARAM, ...)
        - focus-metavariable: $PARAM

    pattern-sinks:
      - patterns:
          - pattern: $LOGGER.$METHOD(...);
          - metavariable-regex:
              metavariable: $LOGGER
              regex: (?i)(logger|log|debug|debugger)
          - metavariable-regex:
              metavariable: $METHOD
              regex: (?i)(info|debug|warn|warning|error|log)
    metadata:
      category: security
      subcategory:
        - vuln
      cwe:
        - "CWE-117: Improper Output Neutralization for Logs"
      confidence: MEDIUM
      likelihood: MEDIUM
      impact: LOW
      owasp:
        - A3:2021 Injection