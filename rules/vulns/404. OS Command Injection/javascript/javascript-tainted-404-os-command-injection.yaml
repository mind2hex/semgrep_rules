rules:
  - id: javascript-tainted-404-os-command-injection
    languages:
      - javascript
      - typescript
    severity: CRITICAL
    message: |
      The application allows the execution of functions or methods which execute commands in the system with non-sanitized parameters. This action would allow an attacker to inject malicious commands in the server to highly increase the attack vectors by escalating privileges, obtaining or modifying sensitive information stored in the machine.
    mode: taint
    pattern-sources:
      - pattern: req.body
      - pattern: req.query
      - pattern: req.params
      - pattern: request.body
      - pattern: request.query
      - pattern: request.params
      - patterns: 
        - pattern: function $FUNC(..., $SINK, ...)
        - focus-metavariable: $SINK
      - patterns:
          - pattern: const $FUNC = function (..., $PARAM, ...) { ... }
          - focus-metavariable: $PARAM
      - patterns:
          - pattern: app.$HTTPMETHOD('...', (..., $SOURCE, ...) => {...})
          - focus-metavariable: $SOURCE
      - patterns:
          - pattern: module.exports = async function $FUNC(..., $SOURCE, ...){...};
          - focus-metavariable: $SOURCE
    
    pattern-sinks:
      - pattern: child_process.exec(...)
      - pattern: child_process.exec(`...`)
      - pattern: child_process.execSync(...)
      - pattern: child_process.spawn(...)
      - pattern: child_process.spawnSync(...)
      - pattern: child_process.execFile(...)
      - pattern: child_process.execFileSync(...)
      - pattern: child_process.fork(...)
      - pattern: exec(...)
      - pattern: execSync(...)
      - pattern: spawn(...)
      - pattern: spawnSync(...)
      - pattern: execFile(...)
      - pattern: execFileSync(...)
      - pattern: fork(...)
      - pattern: shell.exec(...)
      - pattern: execa(...)
      - pattern: cmd.run(...)
      - pattern: util.promisify(...)
    metadata:
      category: security
      subcategory:
        - vuln
      cwe:
        - "CWE-77: Improper Neutralization of Special Elements used in a Command
          ('Command Injection')"
      confidence: MEDIUM
      likelihood: MEDIUM
      impact: HIGH
      owasp:
        - A3:2021 Injection
      technology:
        - expressjs
        - nodejs
